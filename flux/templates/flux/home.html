{% extends 'base.html' %}}

{% load static %}

{% load custom_tags %}

{% block content %}

<div>
    <a href="../create_ticket/" class="button">Create ticket</a>
    <a href="../create_review/" class="button">Make review</a>
</div>

<h2 class="page_title">Recents Posts :</h2>
<div class="ticket_container">

    {% if tickets %}

    {% for ticket in tickets %}
    <div class="ticket">
            <div>
                <img class="ticket_image" src="{{ ticket.image.url }}">
            </div>
            <div class="ticket_content">
                <div class="ticket_header">
                    <span class="title_ticket">{{ ticket.title }}</span>
                    <span class="user_ticket">{{ ticket.time_created|date:"Y-m-d" }} - <a href="{% url 'user_page' ticket.user.id %}">{{ ticket.user }}</a></span>
                </div>
                <p class="description_ticket">{{ ticket.description }}</p>
                <a id="ticket_button" class="button" href="{% url 'create_ticket_review' ticket.id %}">Make review</a>
            </div>
    </div>
    {% endfor %}

    {% for review in reviews %}
    <div class="review">
        <div class="ticket_header">
            <span class="title_ticket">{{ review.ticket }}</span>
            <span class="user_ticket">{{ review.time_created|date:"Y-m-d" }} - <a href="{% url 'user_page' review.user.id %}">{{ review.user }}</a></span>
        </div>
        <h3>{{ review.headline }} -
            {% for i in review.rating|times %}
                <i class="fa-solid fa-bookmark"></i>
            {% endfor %}
            {% for i in 5|times %}
                {% if i >= review.rating %}
                    <i class="fa-regular fa-bookmark"></i>
                {% endif %}
            {% endfor %}
        </h3>

        <p class="description_ticket">{{ review.body }}</p>

        <div class="reviewed_ticket">
            <div>
                <img class="ticket_image" src="{{ review.ticket.image.url }}">
            </div>
            <div class="ticket_content">
                <div class="ticket_header">
                    <span class="title_ticket">{{ review.ticket.title }}</span>
                    <span class="user_ticket">{{ review.ticket.time_created|date:"Y-m-d" }} - <a href="{% url 'user_page' review.ticket.user.id %}">{{ review.ticket.user }}</a></span>
                </div>
                <p class="description_ticket">{{ review.ticket.description }}</p>
        </div>
    </div>

    {% endfor %}

    {% else %}

    <p>No tickets</p>
    {% endif %}

</div>

{% endblock content %}
